<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Aplikasi Cuti Puskesmas</title>

    <!-- Bootstrap 5 -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <!-- Font Awesome 6 -->
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"
      rel="stylesheet"
    />

    <style>
      :root {
        --bg: #f5f7fa;
        --card: #ffffff;
        --muted: #6b7280;
        --border: #e5e7eb;
        --brand: #45c44c;
      }
      body {
        background: var(--bg);
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      }
      .sidebar {
        width: 260px;
        min-height: 100vh;
        background: var(--card);
        border-right: 1px solid var(--border);
        padding: 2rem 1rem;
        position: fixed;
        top: 0;
        left: 0;
      }
      .sidebar .brand {
        font-weight: 700;
        color: #1f2937;
        letter-spacing: 0.3px;
      }
      .menu a {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        padding: 0.75rem 1rem;
        margin: 0.25rem 0;
        color: #374151;
        text-decoration: none;
        border-radius: 10px;
        transition: 0.25s ease;
        font-weight: 500;
      }
      .menu a:hover,
      .menu a.active {
        background: var(--brand);
        color: #fff;
        transform: translateX(4px);
      }
      .offcanvas .menu a {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        padding: 0.75rem 1rem;
        margin: 0.25rem 0;
        color: #374151;
        text-decoration: none;
        border-radius: 10px;
        transition: 0.25s ease;
        font-weight: 500;
      }
      .offcanvas .menu a:hover,
      .offcanvas .menu a.active {
        background: var(--brand);
        color: #fff;
        transform: translateX(4px);
      }
      .content {
        margin-left: 260px;
        padding: 2rem;
        transition: margin-left 0.3s;
      }
      .navbar {
        background: var(--card);
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);
        border-radius: 12px;
      }
      .navbar .brand-title {
        display: flex;
        align-items: center;
        gap: 0.6rem;
        font-weight: 600;
      }
      .hello {
        color: var(--muted);
        font-size: 0.9rem;
      }
      .avatar {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background: var(--brand);
        color: #fff;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 600;
        cursor: pointer;
      }
      .card {
        border: none;
        border-radius: 16px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.06);
        transition: transform 0.2s ease, box-shadow 0.3s ease;
        background: var(--card);
        cursor: default;
      }
      .card:hover {
        transform: translateY(-4px);
        box-shadow: 0 6px 18px rgba(0, 0, 0, 0.08);
      }
      footer {
        margin-left: 260px;
        text-align: center;
        padding: 1rem;
        color: var(--muted);
        font-size: 0.9rem;
        transition: margin-left 0.3s;
      }
      @media (max-width: 991px) {
        .sidebar {
          display: none;
        }
        .content {
          margin-left: 0;
          padding: 1.25rem;
        }
        footer {
          margin-left: 0;
        }
        .hello {
          display: none;
        }
      }
      .badge-baru {
  font-size: 0.75rem;
  padding: 0.25em 0.5em;
  border-radius: 12px;
  display: inline-block;
  vertical-align: middle;
}


    </style>
  </head>
  <body>
    <!-- Sidebar (Desktop) -->
    <aside class="sidebar d-none d-lg-flex flex-column">
      <div class="text-center mb-4">
        <div class="brand">
          <i class="fa-solid fa-hospital text-primary me-2"></i>Puskesmas Trenggalek
        </div>
        <div class="small text-muted"></div>
      </div>
      <nav class="menu">
        <a href="dashboard.html" 
          ><i class="fa-solid fa-calendar-check"></i><span>Dashboard</span></a
        >
        <a href="input-cuti.html"
          ><i class="fa-solid fa-pen-to-square"></i
          ><span>Input Data Cuti</span></a
        >
        <a href="status-cuti.html"
          ><i class="fa-solid fa-clock-rotate-left"></i
          ><span>Lihat Status Cuti</span></a
        >
        <a href="riwayat-cuti.html"
          ><i class="fa-solid fa-book-open"></i
          ><span>Lihat Riwayat Cuti</span></a
        >
        <a href="pengajuan-cuti.html" id="menuPengajuan" class="d-flex justify-content-between align-items-center">
          <span><i class="fa-solid fa-user-check me-2"></i>Pengajuan Cuti</span>
        </a>

        <hr class="my-3" />
         <a href="profile.html" class="active"
          ><i class="fa-solid fa-user"></i
          ><span>Profile</span></a
        >
        <a href="#" onclick="logout()" class="text-danger"
          ><i class="fa-solid fa-right-from-bracket"></i><span>Logout</span></a
        >
      </nav>
    </aside>

    <!-- Offcanvas (Mobile) -->
    <div class="offcanvas offcanvas-start" tabindex="-1" id="mobileSidebar">
      <div class="offcanvas-header border-bottom">
        <h5 class="offcanvas-title fw-bold">
          <i class="fa-solid fa-hospital text-primary me-2"></i>Puskesmas
          Trenggalek
        </h5>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="offcanvas"
        ></button>
      </div>
      <div class="offcanvas-body">
        <nav class="menu">
          <a href="dashboard.html" class="active" data-bs-dismiss="offcanvas"
            ><i class="fa-solid fa-calendar-check"></i><span>Dashboard</span></a
          >
          <a href="input-cuti.html"
            ><i class="fa-solid fa-pen-to-square"></i
            ><span>Input Data Cuti</span></a
          >
          <a href="status-cuti.html"
            ><i class="fa-solid fa-clock-rotate-left"></i
            ><span>Lihat Status Cuti</span></a
          >
          <a href="riwayat-cuti.html"><i class="fa-solid fa-book-open"></i
            ><span>Lihat Riwayat Cuti</span></a
          >
          <a href="pengajuan-cuti.html" id="menuPengajuanMobile" class="d-flex justify-content-between align-items-center">
            <span><i class="fa-solid fa-book-open me-2"></i>Pengajuan Cuti</span>
          </a>

          <hr class="my-3" />
           <a href="profile.html" class="active"><i class="fa-solid fa-user"></i
            ><span>Profile</span></a
          >
          <a
            href="#"
            class="text-danger"
            onclick="logout()"
            data-bs-dismiss="offcanvas"
            ><i class="fa-solid fa-right-from-bracket"></i
            ><span>Logout</span></a
          >
        </nav>
      </div>
    </div>

    <!-- Loading Overlay -->
    <div
      id="loadingOverlay"
      style="
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(255, 255, 255, 0.8);
        z-index: 9999;
        display: flex;
        align-items: center;
        justify-content: center;
      "
    >
      <div class="d-flex align-items-center text-primary">
        <div class="spinner-border me-2" role="status">
          <span class="visually-hidden">Loading...</span>
        </div>
        Memuat data...
      </div>
    </div>
    <!-- Content -->
 <main class="content">
  <nav class="navbar navbar-expand-lg rounded mb-4 px-3">
    <!-- navbar seperti milikmu -->
  </nav>

  <div class="container">
    <div class="card p-4 mx-auto" style="max-width: 600px;">
      <div class="d-flex align-items-center mb-3">
        <div class="avatar me-3" id="avatarProfileLarge">P</div>
        <div>
          <h4 id="namaProfile" class="mb-0">Nama Pegawai</h4>
          <small class="text-muted" id="jabatanProfile">Jabatan</small>
        </div>
      </div>
      <ul class="list-group list-group-flush mb-3">
        <li class="list-group-item">
          <strong>Username:</strong> <span id="usernameProfile">-</span>
        </li>
        <li class="list-group-item">
          <strong>Nama:</strong> <span id="namaProfileText">-</span>
        </li>
        <li class="list-group-item">
          <strong>Jabatan:</strong> <span id="jabatanProfileText">-</span>
        </li>
      </ul>

      <h5>Ganti Password</h5>

      <!-- Form POST biasa, target iframe untuk submit tanpa reload halaman -->
      <form id="formGantiPassword" method="post" action="https://script.google.com/macros/s/AKfycbz9MpDI3ilm3O-85KNTcGZ70D8Gv8K_UUHMc4CSrmJCsiM5Wl2oYd3nEXhyp9F1Nw06/exec" target="dummyFrame">
        <input type="hidden" name="action" value="gantiPassword">
        <input type="hidden" name="username" id="formUsername" value="">
        <div class="mb-3">
          <input type="password" name="passLama" id="passLama" class="form-control mb-2" placeholder="Password Lama" required>
          <input type="password" name="passBaru" id="passBaru" class="form-control mb-2" placeholder="Password Baru" required>
          <input type="password" name="passKonf" id="passKonf" class="form-control" placeholder="Konfirmasi Password Baru" required>
        </div>
        <button type="submit" class="btn btn-success w-100"  onclick="gantiPassword(event)"><i class="fa-solid fa-key me-2"></i>Ganti Password</button>
      </form>

      <!-- Iframe hidden -->
      <iframe name="dummyFrame" style="display:none;"></iframe>

    </div>
  </div>
</main>


<script>
const scriptURL = "https://script.google.com/macros/s/AKfycbz9MpDI3ilm3O-85KNTcGZ70D8Gv8K_UUHMc4CSrmJCsiM5Wl2oYd3nEXhyp9F1Nw06/exec";

document.addEventListener("DOMContentLoaded", () => {
  const overlay = document.getElementById("loadingOverlay");
  const userData = localStorage.getItem("userData");
  if(!userData) return window.location.href="index.html";

  const user = JSON.parse(userData);

  document.getElementById("namaProfile").textContent = user.nama || "-";
  document.getElementById("jabatanProfile").textContent = user.jabatan || "-";
  document.getElementById("usernameProfile").textContent = user.username || "-";
  document.getElementById("namaProfileText").textContent = user.nama || "-";
  document.getElementById("jabatanProfileText").textContent = user.jabatan || "-";
  document.getElementById("formUsername").value = user.username || "";

  const avatar = document.getElementById("avatarProfileLarge");
  if(avatar) avatar.textContent = (user.nama||"P").charAt(0).toUpperCase();

  if(overlay) overlay.style.display = "none";
});

function logout(){
  localStorage.removeItem("userData");
  window.location.href="index.html";
}

async function gantiPassword(event){
  event.preventDefault(); // cegah reload form

  const passLama = document.getElementById("passLama").value.trim();
  const passBaru = document.getElementById("passBaru").value.trim();
  const passKonf = document.getElementById("passKonf").value.trim();
  const overlay = document.getElementById("loadingOverlay");

  if(!passLama || !passBaru || !passKonf){
    alert("Semua field harus diisi!");
    return;
  }
  if(passBaru !== passKonf){
    alert("Password baru dan konfirmasi tidak sama!");
    return;
  }

  const userData = JSON.parse(localStorage.getItem("userData") || "{}");
  const payload = {
    action: "gantiPassword",
    username: userData.username,
    passLama,
    passBaru
  };

  try {
    if(overlay) overlay.style.display = "flex"; // tampilkan loading
    const response = await fetch(scriptURL, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(payload)
    });

    const res = await response.json();

    if(res.status === "success"){
      alert("Password berhasil diubah!");
      document.getElementById("passLama").value = "";
      document.getElementById("passBaru").value = "";
      document.getElementById("passKonf").value = "";
    } else {
      alert("Gagal mengubah password: " + res.message);
    }
  } catch(err){
    console.error(err);
    alert("Terjadi kesalahan saat menghubungi server.");
  } finally {
    if(overlay) overlay.style.display = "none"; // sembunyikan loading
  }
}
</script>

</body>
</html>